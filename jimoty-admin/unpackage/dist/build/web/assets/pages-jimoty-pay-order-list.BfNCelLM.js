import{_ as e,Y as t,n as a,r as l,a as n,c as i,w as r,i as s,b as o,d,e as u,f as c,o as f,g as h,j as g,k as p,l as _,F as m,I as y,m as C,t as b}from"./index-DvwuWHCT.js";import{_ as x}from"./download-excel.DZLKoZwF.js";import{_ as D}from"./uni-dateformat.DJj25wzG.js";import{_ as S}from"./uni-pagination.DcoG_qbw.js";import{_ as k}from"./unicloud-db.BruyzEc-.js";import{e as $,f as v}from"./jimoty-pay-order.BEx7_JJD.js";const w=t.database(),z=[],j={ascending:"asc",descending:"desc"};const T=e({data:()=>({collectionList:"jimoty-pay-order",query:"",where:"",orderby:"",orderByFieldName:"",selectedIndexs:[],options:{pageSize:20,pageCurrent:1,filterData:{status_localdata:[{text:"已关闭",value:-1},{text:"未支付",value:0},{text:"已支付",value:1},{text:"已部分退款",value:2},{text:"已全额退款",value:3}]},...$},imageStyles:{width:64,height:64},exportExcel:{filename:"jimoty-pay-order.xls",type:"xls",fields:{"用户ID":"user_id","订单总金额":"total_fee","自定义数据":"custom","业务系统订单号":"order_no","订单类型":"type","订单状态":"status","创建时间":"create_date","支付时间":"pay_date"}},exportExcelData:[]}),onLoad(){this._filter={}},onReady(){this.$refs.udb.loadData()},methods:{onqueryload(e){this.exportExcelData=e},getWhere(){const e=this.query.trim();if(!e)return"";const t=new RegExp(e,"i");return z.map((e=>t+".test("+e+")")).join(" || ")},search(){const e=this.getWhere();this.where=e,this.$nextTick((()=>{this.loadData()}))},loadData(e=!0){this.$refs.udb.loadData({clear:e})},onPageChanged(e){this.selectedIndexs.length=0,this.$refs.table.clearSelection(),this.$refs.udb.loadData({current:e.current})},navigateTo(e,t){a({url:e,events:{refreshData:()=>{this.loadData(t)}}})},selectedItems(){var e=this.$refs.udb.dataList;return this.selectedIndexs.map((t=>e[t]._id))},delTable(){this.$refs.udb.remove(this.selectedItems(),{success:e=>{this.$refs.table.clearSelection()}})},selectionChange(e){this.selectedIndexs=e.detail.index},confirmDelete(e){this.$refs.udb.remove(e,{success:e=>{this.$refs.table.clearSelection()}})},sortChange(e,t){this.orderByFieldName=t,e.order?this.orderby=t+" "+j[e.order]:this.orderby="",this.$refs.table.clearSelection(),this.$nextTick((()=>{this.$refs.udb.loadData()}))},filterChange(e,t){this._filter[t]={type:e.filterType,value:e.filter};let a=v(this._filter,w.command);Object.keys(a).length?this.where=a:this.where="",this.$nextTick((()=>{this.$refs.udb.loadData()}))}}},[["render",function(e,t,a,$,v,w){const z=s,j=y,T=C,F=l(n("download-excel"),x),I=l(n("uni-th"),o),E=l(n("uni-tr"),d),V=l(n("uni-td"),u),q=l(n("uni-dateformat"),D),L=l(n("uni-table"),c),R=l(n("uni-pagination"),S),U=l(n("unicloud-db"),k);return f(),i(z,null,{default:r((()=>[h(z,{class:"uni-header"},{default:r((()=>[h(z,{class:"uni-group"},{default:r((()=>[h(z,{class:"uni-title"}),h(z,{class:"uni-sub-title"})])),_:1}),h(z,{class:"uni-group"},{default:r((()=>[h(j,{class:"uni-search",type:"text",modelValue:v.query,"onUpdate:modelValue":t[0]||(t[0]=e=>v.query=e),onConfirm:w.search,placeholder:"请输入搜索内容"},null,8,["modelValue","onConfirm"]),h(T,{class:"uni-button",type:"default",size:"mini",onClick:w.search},{default:r((()=>[g("搜索")])),_:1},8,["onClick"]),h(T,{class:"uni-button",type:"default",size:"mini",onClick:t[1]||(t[1]=e=>w.navigateTo("./add"))},{default:r((()=>[g("新增")])),_:1}),h(T,{class:"uni-button",type:"default",size:"mini",disabled:!v.selectedIndexs.length,onClick:w.delTable},{default:r((()=>[g("批量删除")])),_:1},8,["disabled","onClick"]),h(F,{class:"hide-on-phone",fields:v.exportExcel.fields,data:v.exportExcelData,type:v.exportExcel.type,name:v.exportExcel.filename},{default:r((()=>[h(T,{class:"uni-button",type:"primary",size:"mini"},{default:r((()=>[g("导出 Excel")])),_:1})])),_:1},8,["fields","data","type","name"])])),_:1})])),_:1}),h(z,{class:"uni-container"},{default:r((()=>[h(U,{ref:"udb",collection:v.collectionList,field:"user_id,total_fee,custom,order_no,type,status,create_date,pay_date",where:v.where,"page-data":"replace",orderby:v.orderby,getcount:!0,"page-size":v.options.pageSize,"page-current":v.options.pageCurrent,options:v.options,loadtime:"manual",onLoad:w.onqueryload},{default:r((({data:e,pagination:a,loading:l,error:n,options:s})=>[h(L,{ref:"table",loading:l,emptyText:n.message||"没有更多数据",border:"",stripe:"",type:"selection",onSelectionChange:w.selectionChange},{default:r((()=>[h(E,null,{default:r((()=>[h(I,{align:"center",sortable:"",onSortChange:t[2]||(t[2]=e=>w.sortChange(e,"user_id"))},{default:r((()=>[g("用户ID")])),_:1}),h(I,{align:"center","filter-type":"range",onFilterChange:t[3]||(t[3]=e=>w.filterChange(e,"total_fee")),sortable:"",onSortChange:t[4]||(t[4]=e=>w.sortChange(e,"total_fee"))},{default:r((()=>[g("订单总金额")])),_:1}),h(I,{align:"center",sortable:"",onSortChange:t[5]||(t[5]=e=>w.sortChange(e,"custom"))},{default:r((()=>[g("自定义数据")])),_:1}),h(I,{align:"center","filter-type":"search",onFilterChange:t[6]||(t[6]=e=>w.filterChange(e,"order_no")),sortable:"",onSortChange:t[7]||(t[7]=e=>w.sortChange(e,"order_no"))},{default:r((()=>[g("业务系统订单号")])),_:1}),h(I,{align:"center","filter-type":"search",onFilterChange:t[8]||(t[8]=e=>w.filterChange(e,"type")),sortable:"",onSortChange:t[9]||(t[9]=e=>w.sortChange(e,"type"))},{default:r((()=>[g("订单类型")])),_:1}),h(I,{align:"center","filter-type":"select","filter-data":s.filterData.status_localdata,onFilterChange:t[10]||(t[10]=e=>w.filterChange(e,"status"))},{default:r((()=>[g("订单状态")])),_:2},1032,["filter-data"]),h(I,{align:"center","filter-type":"timestamp",onFilterChange:t[11]||(t[11]=e=>w.filterChange(e,"create_date")),sortable:"",onSortChange:t[12]||(t[12]=e=>w.sortChange(e,"create_date"))},{default:r((()=>[g("创建时间")])),_:1}),h(I,{align:"center","filter-type":"timestamp",onFilterChange:t[13]||(t[13]=e=>w.filterChange(e,"pay_date")),sortable:"",onSortChange:t[14]||(t[14]=e=>w.sortChange(e,"pay_date"))},{default:r((()=>[g("支付时间")])),_:1}),h(I,{align:"center"},{default:r((()=>[g("操作")])),_:1})])),_:2},1024),(f(!0),p(m,null,_(e,((e,t)=>(f(),i(E,{key:t},{default:r((()=>[h(V,{align:"center"},{default:r((()=>[g(b(e.user_id),1)])),_:2},1024),h(V,{align:"center"},{default:r((()=>[g(b(e.total_fee),1)])),_:2},1024),h(V,{align:"center"},{default:r((()=>[g(b(e.custom),1)])),_:2},1024),h(V,{align:"center"},{default:r((()=>[g(b(e.order_no),1)])),_:2},1024),h(V,{align:"center"},{default:r((()=>[g(b(e.type),1)])),_:2},1024),h(V,{align:"center"},{default:r((()=>[g(b(s.status_valuetotext[e.status]),1)])),_:2},1024),h(V,{align:"center"},{default:r((()=>[h(q,{threshold:[0,0],date:e.create_date},null,8,["date"])])),_:2},1024),h(V,{align:"center"},{default:r((()=>[h(q,{threshold:[0,0],date:e.pay_date},null,8,["date"])])),_:2},1024),h(V,{align:"center"},{default:r((()=>[h(z,{class:"uni-group"},{default:r((()=>[h(T,{onClick:t=>w.navigateTo("./edit?id="+e._id,!1),class:"uni-button",size:"mini",type:"primary"},{default:r((()=>[g("修改")])),_:2},1032,["onClick"]),h(T,{onClick:t=>w.confirmDelete(e._id),class:"uni-button",size:"mini",type:"warn"},{default:r((()=>[g("删除")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1032,["loading","emptyText","onSelectionChange"]),h(z,{class:"uni-pagination-box"},{default:r((()=>[h(R,{"show-icon":"","page-size":a.size,modelValue:a.current,"onUpdate:modelValue":e=>a.current=e,total:a.count,onChange:w.onPageChanged},null,8,["page-size","modelValue","onUpdate:modelValue","total","onChange"])])),_:2},1024)])),_:1},8,["collection","where","orderby","page-size","page-current","options","onLoad"])])),_:1})])),_:1})}]]);export{T as default};
