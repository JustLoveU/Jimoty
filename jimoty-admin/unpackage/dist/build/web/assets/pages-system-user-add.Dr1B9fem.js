import{_ as a,Y as e,n as l,M as t,p as o,G as s,s as n,N as m,r,a as u,c as i,w as d,i as c,o as p,g as f,K as b,j as h,t as g,U as V,m as _,Z as D}from"./index-DvwuWHCT.js";import{_ as k}from"./uni-easyinput.CI0qa16L.js";import{_ as x}from"./uni-forms-item.D9H7wr3d.js";import{_ as v}from"./uni-data-checkbox.CVdOplTL.js";import{_ as U}from"./uni-forms.IzwqOl-w.js";import{v as y}from"./uni-id-users.DFlB41Hw.js";import"./uni-load-more.BsuNNNgF.js";const w=e.database();function A(a){let e={};for(let l in y)a.includes(l)&&(e[l]=y[l]);return e}w.command;const C=a({data:()=>({formData:{username:"",nickname:"",password:"",role:[],authorizedApp:[],tags:[],mobile:void 0,email:void 0,status:!0},rules:{...A(["username","password","role","mobile","email"]),status:{rules:[{format:"bool"}]}},roles:[]}),onLoad(){this.loadroles()},methods:{gotoAppList(){l({url:"../app/list"})},gotoTagList(){l({url:"../tag/list"})},gotoTagAdd(){l({url:"../tag/add",events:{refreshCheckboxData:()=>{this.$refs.checkbox.loadData()}}})},submitForm(){this.$refs.form.submit()},submit(a){const{value:e,errors:l}=a.detail;l||(t({title:"提交中...",mask:!0}),"boolean"==typeof e.status&&(e.status=Number(!e.status)),this.$request("addUser",e).then((()=>{o({title:"新增成功"}),this.getOpenerEventChannel().emit("refreshData"),setTimeout((()=>s()),500)})).catch((a=>{n({content:a.message||"请求服务失败",showCancel:!1})})).finally((a=>{m()})))},loadroles(){w.collection("uni-id-roles").limit(500).get().then((a=>{const e=[];this.roles=a.result.data.map((a=>(e.push(a.role_id),{value:a.role_id,text:a.role_name}))),-1===e.indexOf("admin")&&this.roles.unshift({value:"admin",text:"超级管理员"})})).catch((a=>{n({title:"提示",content:a.message,showCancel:!1})}))}}},[["render",function(a,e,l,t,o,s){const n=r(u("uni-easyinput"),k),m=r(u("uni-forms-item"),x),y=r(u("uni-data-checkbox"),v),w=V,A=_,C=D,j=c,T=r(u("uni-forms"),U);return p(),i(j,{class:"uni-container"},{default:d((()=>[f(T,{ref:"form",modelValue:o.formData,"onUpdate:modelValue":e[12]||(e[12]=a=>o.formData=a),rules:o.rules,validateTrigger:"bind",onSubmit:s.submit},{default:d((()=>[f(m,{name:"username",label:"用户名",required:""},{default:d((()=>[f(n,{modelValue:o.formData.username,"onUpdate:modelValue":e[0]||(e[0]=a=>o.formData.username=a),clearable:!1,placeholder:"请输入用户名"},null,8,["modelValue"])])),_:1}),f(m,{name:"nickname",label:"用户昵称",required:""},{default:d((()=>[f(n,{modelValue:o.formData.nickname,"onUpdate:modelValue":e[1]||(e[1]=a=>o.formData.nickname=a),clearable:!1,placeholder:"请输入用户昵称"},null,8,["modelValue"])])),_:1}),f(m,{name:"password",label:"初始密码",required:""},{default:d((()=>[f(n,{modelValue:o.formData.password,"onUpdate:modelValue":e[2]||(e[2]=a=>o.formData.password=a),clearable:!1,placeholder:"请输入初始密码"},null,8,["modelValue"])])),_:1}),f(m,{name:"role",label:"角色列表",class:"flex-center-x"},{default:d((()=>[f(y,{multiple:"",localdata:o.roles,modelValue:o.formData.role,"onUpdate:modelValue":e[3]||(e[3]=a=>o.formData.role=a)},null,8,["localdata","modelValue"])])),_:1}),f(m,{name:"tags",label:"用户标签",labelWidth:"100",class:"flex-center-x"},{default:d((()=>[f(y,{ref:"checkbox",multiple:!0,modelValue:o.formData.tags,"onUpdate:modelValue":e[4]||(e[4]=a=>o.formData.tags=a),collection:"uni-id-tag",field:"tagid as value, name as text"},null,8,["modelValue"]),b("span",{class:"link-btn",onClick:e[5]||(e[5]=(...a)=>s.gotoTagAdd&&s.gotoTagAdd(...a))},"新增"),b("span",{class:"link-btn",onClick:e[6]||(e[6]=(...a)=>s.gotoTagList&&s.gotoTagList(...a)),style:{"margin-left":"10px"}},"管理")])),_:1}),f(m,{name:"authorizedApp",label:"可登录应用",labelWidth:"100",class:"flex-center-x"},{default:d((()=>[f(y,{multiple:!0,modelValue:o.formData.authorizedApp,"onUpdate:modelValue":e[7]||(e[7]=a=>o.formData.authorizedApp=a),collection:"opendb-app-list",field:"appid as value, name as text"},null,8,["modelValue"]),b("span",{class:"link-btn",onClick:e[8]||(e[8]=(...a)=>s.gotoAppList&&s.gotoAppList(...a))},"管理")])),_:1}),f(m,{name:"mobile",label:"手机号"},{default:d((()=>[f(n,{modelValue:o.formData.mobile,"onUpdate:modelValue":e[9]||(e[9]=a=>o.formData.mobile=a),clearable:!1,placeholder:"请输入手机号"},null,8,["modelValue"])])),_:1}),f(m,{name:"email",label:"邮箱"},{default:d((()=>[f(n,{modelValue:o.formData.email,"onUpdate:modelValue":e[10]||(e[10]=a=>o.formData.email=a),clearable:!1,placeholder:"请输入邮箱"},null,8,["modelValue"])])),_:1}),f(m,{name:"status",label:"是否启用"},{default:d((()=>[f(w,{onChange:e[11]||(e[11]=e=>a.binddata("status",e.detail.value)),checked:o.formData.status},null,8,["checked"])])),_:1}),f(j,{class:"uni-button-group"},{default:d((()=>[f(A,{style:{width:"100px"},type:"primary",class:"uni-button",onClick:s.submitForm},{default:d((()=>[h(g(a.$t("common.button.submit")),1)])),_:1},8,["onClick"]),f(C,{"open-type":"navigateBack",style:{"margin-left":"15px"}},{default:d((()=>[f(A,{style:{width:"100px"},class:"uni-button"},{default:d((()=>[h(g(a.$t("common.button.back")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue","rules","onSubmit"])])),_:1})}],["__scopeId","data-v-089b2c03"]]);export{C as default};
