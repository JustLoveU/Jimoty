import{_ as e,Y as a,p as t,n,r,a as i,c as s,w as l,i as o,b as d,d as u,e as c,f as p,o as m,g,j as f,t as h,k as _,l as b,F as y,I as C,m as x}from"./index-DvwuWHCT.js";import{_ as w}from"./uni-stat-breadcrumb.1_qCubna.js";import{_ as z}from"./uni-dateformat.DJj25wzG.js";import{_ as j}from"./uni-pagination.DcoG_qbw.js";import{_ as k}from"./unicloud-db.BruyzEc-.js";const D=a.database(),V=["user_id.username","user_id.nickname","type","ip"];const $=e({data:()=>({collectionList:[D.collection("uni-id-log").field("type, ip, create_date, user_id").getTemp(),D.collection("uni-id-users").field("_id, username,nickname").getTemp()],query:"",where:"",orderby:"create_date desc",options:{pageSize:20,pageCurrent:1}}),methods:{getWhere(){const e=this.query.trim();if(!e)return"";let a;try{a=new RegExp(e,"i")}catch(n){return void t({title:"请勿输入等不满足正则格式的符号",icon:"none"})}return V.map((e=>a+".test("+e+")")).join(" || ")},search(){const e=this.getWhere(),a=e===this.where;this.where=e,a&&this.loadData()},loadData(e=!0){this.$refs.udb.loadData({clear:e})},onPageChanged(e){this.$refs.udb.loadData({current:e.current})},navigateTo(e){n({url:e,events:{refreshData:()=>{this.loadData()}}})},selectedItems(){let e=this.$refs.udb.dataList;return this.selectedIndexs.map((a=>e[a]._id))},delTable(){this.$refs.udb.remove(this.selectedItems())},selectionChange(e){this.selectedIndexs=e.detail.index},confirmDelete(e){this.$refs.udb.remove(e)}}},[["render",function(e,a,t,n,D,V){const $=r(i("uni-stat-breadcrumb"),w),I=C,T=x,q=o,v=r(i("uni-th"),d),L=r(i("uni-tr"),u),P=r(i("uni-td"),c),S=r(i("uni-dateformat"),z),U=r(i("uni-table"),p),F=r(i("uni-pagination"),j),R=r(i("unicloud-db"),k);return m(),s(q,null,{default:l((()=>[g(q,{class:"uni-header"},{default:l((()=>[g($,{class:"uni-stat-breadcrumb-on-phone"}),g(q,{class:"uni-group"},{default:l((()=>[g(I,{class:"uni-search",type:"text",modelValue:D.query,"onUpdate:modelValue":a[0]||(a[0]=e=>D.query=e),onConfirm:V.search,placeholder:e.$t("common.placeholder.query")},null,8,["modelValue","onConfirm","placeholder"]),g(T,{class:"uni-button hide-on-phone",type:"default",size:"mini",onClick:V.search},{default:l((()=>[f(h(e.$t("common.button.search")),1)])),_:1},8,["onClick"])])),_:1})])),_:1}),g(q,{class:"uni-container"},{default:l((()=>[g(R,{ref:"udb",collection:D.collectionList,options:D.options,where:D.where,"page-data":"replace",orderby:D.orderby,getcount:!0,"page-size":D.options.pageSize,"page-current":D.options.pageCurrent},{default:l((({data:e,pagination:a,loading:t,error:n})=>[g(U,{loading:t,emptyText:n.message||"没有更多数据",border:"",stripe:""},{default:l((()=>[g(L,null,{default:l((()=>[g(v,{align:"center"},{default:l((()=>[f("序号")])),_:1}),g(v,{align:"center"},{default:l((()=>[f("用户名")])),_:1}),g(v,{align:"center"},{default:l((()=>[f("昵称")])),_:1}),g(v,{align:"center"},{default:l((()=>[f("内容")])),_:1}),g(v,{align:"center"},{default:l((()=>[f("IP")])),_:1}),g(v,{align:"center"},{default:l((()=>[f("时间")])),_:1})])),_:1}),(m(!0),_(y,null,b(e,((e,t)=>(m(),s(L,{key:t},{default:l((()=>[g(P,{align:"center"},{default:l((()=>[f(h((a.current-1)*a.size+(t+1)),1)])),_:2},1024),g(P,{align:"center"},{default:l((()=>[f(h(e.user_id[0]&&e.user_id[0].username||"-"),1)])),_:2},1024),g(P,{align:"center"},{default:l((()=>[f(h(e.user_id[0]&&e.user_id[0].nickname||"-"),1)])),_:2},1024),g(P,{align:"center"},{default:l((()=>[f(h(e.type),1)])),_:2},1024),g(P,{align:"center"},{default:l((()=>[f(h(e.ip),1)])),_:2},1024),g(P,{align:"center"},{default:l((()=>[g(S,{date:e.create_date,threshold:[0,0]},null,8,["date"])])),_:2},1024)])),_:2},1024)))),128))])),_:2},1032,["loading","emptyText"]),g(q,{class:"uni-pagination-box"},{default:l((()=>[g(F,{"show-icon":"","page-size":a.size,modelValue:a.current,"onUpdate:modelValue":e=>a.current=e,total:a.count,onChange:V.onPageChanged},null,8,["page-size","modelValue","onUpdate:modelValue","total","onChange"])])),_:2},1024)])),_:1},8,["collection","options","where","orderby","page-size","page-current"])])),_:1})])),_:1})}]]);export{$ as default};
