import{_ as e,Y as t,n as a,r as n,a as s,c as l,w as i,i as o,b as r,d,e as c,f as u,o as h,g,j as f,k as p,l as m,F as _,I as y,m as C,t as b}from"./index-DvwuWHCT.js";import{_ as x}from"./download-excel.DZLKoZwF.js";import{_ as S}from"./uni-dateformat.DJj25wzG.js";import{_ as k}from"./uni-pagination.DcoG_qbw.js";import{_ as D}from"./unicloud-db.BruyzEc-.js";import{e as $,f as w}from"./jimoty-notice.CyVwI5_S.js";const z=t.database(),j=[],v={ascending:"asc",descending:"desc"};const T=e({data:()=>({collectionList:"jimoty-notice",query:"",where:"",orderby:"",orderByFieldName:"",selectedIndexs:[],options:{pageSize:20,pageCurrent:1,filterData:{},...$},imageStyles:{width:64,height:64},exportExcel:{filename:"jimoty-notice.xls",type:"xls",fields:{"通知类型":"type","发送者":"sendPeople","接收者":"receive","消息":"message","其他消息":"otherMessage","消息状态":"status",create_date:"create_date"}},exportExcelData:[]}),onLoad(){this._filter={}},onReady(){this.$refs.udb.loadData()},methods:{onqueryload(e){this.exportExcelData=e},getWhere(){const e=this.query.trim();if(!e)return"";const t=new RegExp(e,"i");return j.map((e=>t+".test("+e+")")).join(" || ")},search(){const e=this.getWhere();this.where=e,this.$nextTick((()=>{this.loadData()}))},loadData(e=!0){this.$refs.udb.loadData({clear:e})},onPageChanged(e){this.selectedIndexs.length=0,this.$refs.table.clearSelection(),this.$refs.udb.loadData({current:e.current})},navigateTo(e,t){a({url:e,events:{refreshData:()=>{this.loadData(t)}}})},selectedItems(){var e=this.$refs.udb.dataList;return this.selectedIndexs.map((t=>e[t]._id))},delTable(){this.$refs.udb.remove(this.selectedItems(),{success:e=>{this.$refs.table.clearSelection()}})},selectionChange(e){this.selectedIndexs=e.detail.index},confirmDelete(e){this.$refs.udb.remove(e,{success:e=>{this.$refs.table.clearSelection()}})},sortChange(e,t){this.orderByFieldName=t,e.order?this.orderby=t+" "+v[e.order]:this.orderby="",this.$refs.table.clearSelection(),this.$nextTick((()=>{this.$refs.udb.loadData()}))},filterChange(e,t){this._filter[t]={type:e.filterType,value:e.filter};let a=w(this._filter,z.command);Object.keys(a).length?this.where=a:this.where="",this.$nextTick((()=>{this.$refs.udb.loadData()}))}}},[["render",function(e,t,a,$,w,z){const j=o,v=y,T=C,E=n(s("download-excel"),x),I=n(s("uni-th"),r),F=n(s("uni-tr"),d),V=n(s("uni-td"),c),q=n(s("uni-dateformat"),S),L=n(s("uni-table"),u),P=n(s("uni-pagination"),k),M=n(s("unicloud-db"),D);return h(),l(j,null,{default:i((()=>[g(j,{class:"uni-header"},{default:i((()=>[g(j,{class:"uni-group"},{default:i((()=>[g(j,{class:"uni-title"}),g(j,{class:"uni-sub-title"})])),_:1}),g(j,{class:"uni-group"},{default:i((()=>[g(v,{class:"uni-search",type:"text",modelValue:w.query,"onUpdate:modelValue":t[0]||(t[0]=e=>w.query=e),onConfirm:z.search,placeholder:"请输入搜索内容"},null,8,["modelValue","onConfirm"]),g(T,{class:"uni-button",type:"default",size:"mini",onClick:z.search},{default:i((()=>[f("搜索")])),_:1},8,["onClick"]),g(T,{class:"uni-button",type:"default",size:"mini",onClick:t[1]||(t[1]=e=>z.navigateTo("./add"))},{default:i((()=>[f("新增")])),_:1}),g(T,{class:"uni-button",type:"default",size:"mini",disabled:!w.selectedIndexs.length,onClick:z.delTable},{default:i((()=>[f("批量删除")])),_:1},8,["disabled","onClick"]),g(E,{class:"hide-on-phone",fields:w.exportExcel.fields,data:w.exportExcelData,type:w.exportExcel.type,name:w.exportExcel.filename},{default:i((()=>[g(T,{class:"uni-button",type:"primary",size:"mini"},{default:i((()=>[f("导出 Excel")])),_:1})])),_:1},8,["fields","data","type","name"])])),_:1})])),_:1}),g(j,{class:"uni-container"},{default:i((()=>[g(M,{ref:"udb",collection:w.collectionList,field:"type,sendPeople,receive,message,otherMessage,status,create_date",where:w.where,"page-data":"replace",orderby:w.orderby,getcount:!0,"page-size":w.options.pageSize,"page-current":w.options.pageCurrent,options:w.options,loadtime:"manual",onLoad:z.onqueryload},{default:i((({data:e,pagination:a,loading:n,error:s,options:o})=>[g(L,{ref:"table",loading:n,emptyText:s.message||"没有更多数据",border:"",stripe:"",type:"selection",onSelectionChange:z.selectionChange},{default:i((()=>[g(F,null,{default:i((()=>[g(I,{align:"center","filter-type":"search",onFilterChange:t[2]||(t[2]=e=>z.filterChange(e,"type")),onSortChange:t[3]||(t[3]=e=>z.sortChange(e,"type"))},{default:i((()=>[f("通知类型")])),_:1}),g(I,{align:"center",onSortChange:t[4]||(t[4]=e=>z.sortChange(e,"sendPeople"))},{default:i((()=>[f("发送者")])),_:1}),g(I,{align:"center",onSortChange:t[5]||(t[5]=e=>z.sortChange(e,"receive"))},{default:i((()=>[f("接收者")])),_:1}),g(I,{align:"center","filter-type":"search",onFilterChange:t[6]||(t[6]=e=>z.filterChange(e,"message")),onSortChange:t[7]||(t[7]=e=>z.sortChange(e,"message"))},{default:i((()=>[f("消息")])),_:1}),g(I,{align:"center",onSortChange:t[8]||(t[8]=e=>z.sortChange(e,"otherMessage"))},{default:i((()=>[f("其他消息")])),_:1}),g(I,{align:"center",onSortChange:t[9]||(t[9]=e=>z.sortChange(e,"status"))},{default:i((()=>[f("消息状态")])),_:1}),g(I,{align:"center","filter-type":"timestamp",onFilterChange:t[10]||(t[10]=e=>z.filterChange(e,"create_date")),onSortChange:t[11]||(t[11]=e=>z.sortChange(e,"create_date"))},{default:i((()=>[f("create_date")])),_:1}),g(I,{align:"center"},{default:i((()=>[f("操作")])),_:1})])),_:1}),(h(!0),p(_,null,m(e,((e,t)=>(h(),l(F,{key:t},{default:i((()=>[g(V,{align:"center"},{default:i((()=>[f(b(e.type),1)])),_:2},1024),g(V,{align:"center"},{default:i((()=>[f(b(e.sendPeople),1)])),_:2},1024),g(V,{align:"center"},{default:i((()=>[f(b(e.receive),1)])),_:2},1024),g(V,{align:"center"},{default:i((()=>[f(b(e.message),1)])),_:2},1024),g(V,{align:"center"},{default:i((()=>[f(b(e.otherMessage),1)])),_:2},1024),g(V,{align:"center"},{default:i((()=>[f(b(1==e.status?"✅":"❌"),1)])),_:2},1024),g(V,{align:"center"},{default:i((()=>[g(q,{threshold:[0,0],date:e.create_date},null,8,["date"])])),_:2},1024),g(V,{align:"center"},{default:i((()=>[g(j,{class:"uni-group"},{default:i((()=>[g(T,{onClick:t=>z.navigateTo("./edit?id="+e._id,!1),class:"uni-button",size:"mini",type:"primary"},{default:i((()=>[f("修改")])),_:2},1032,["onClick"]),g(T,{onClick:t=>z.confirmDelete(e._id),class:"uni-button",size:"mini",type:"warn"},{default:i((()=>[f("删除")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1032,["loading","emptyText","onSelectionChange"]),g(j,{class:"uni-pagination-box"},{default:i((()=>[g(P,{"show-icon":"","page-size":a.size,modelValue:a.current,"onUpdate:modelValue":e=>a.current=e,total:a.count,onChange:z.onPageChanged},null,8,["page-size","modelValue","onUpdate:modelValue","total","onChange"])])),_:2},1024)])),_:1},8,["collection","where","orderby","page-size","page-current","options","onLoad"])])),_:1})])),_:1})}]]);export{T as default};
